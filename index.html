<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Button Game</title>
<style>
    body {
        margin: 0;
        padding: 20px;
        background: #f6f9fc;
        font-family: Arial, sans-serif;
        overflow-x: hidden;
    }

    h1 {
        text-align: center;
        margin-bottom: 10px;
    }

    #gameArea {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
    }

    .btn {
        padding: 14px 20px;
        font-size: 18px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: transform 0.12s ease, background 0.2s ease;
        user-select: none;
    }

    .btn:active {
        transform: scale(0.85);
    }

    .bomb {
        background: #ff4d4d;
        color: white;
    }

    .bonus {
        background: #4CAF50;
        color: white;
    }

    .disabled {
        pointer-events: none;
        opacity: 0.5;
    }

    #timer, #score {
        text-align: center;
        font-size: 22px;
        margin: 5px;
    }

    #leaderboard {
        margin-top: 20px;
        padding: 10px;
        background: white;
        border-radius: 10px;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
        box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }

    #leaderboard h2 {
        margin: 0;
        text-align: center;
    }

    #restartBtn {
        margin: 20px auto;
        display: block;
        padding: 12px 18px;
        font-size: 18px;
        cursor: pointer;
        border: none;
        border-radius: 10px;
        background: #007BFF;
        color: white;
    }

    /* MOBILE SIZE BOOST */
    @media (max-width: 600px) {
        .btn {
            padding: 20px 24px;
            font-size: 22px;
        }
        #gameArea {
            justify-content: space-between;
        }
    }
</style>
</head>

<body>
<h1>Button Game</h1>
<div id="timer">Timer: 30</div>
<div id="score">Score: 0</div>

<div id="gameArea"></div>

<button id="restartBtn">Restart</button>

<div id="leaderboard">
    <h2>Leaderboard</h2>
    <ul id="leaderboardList"></ul>
</div>

<!-- FIREBASE -->
<script type="module">
/* -----------------------------------------------------
   ðŸ”¥ 1. SETUP FIREBASE (USE YOUR REAL CONFIG HERE)
------------------------------------------------------ */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy } 
    from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

// â›”â›”â›” REPLACE THIS CONFIG WITH YOUR FIREBASE CONFIG â›”â›”â›”
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_DOMAIN",
    projectId: "button-game-75748",
    storageBucket: "button-game-75748.appspot.com",
    messagingSenderId: "XXXXXXXXXXXX",
    appId: "XXXXXXXXXXXX"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* -----------------------------------------------------
   GAME VARIABLES
------------------------------------------------------ */
let score = 0;
let timeLeft = 30;
let timerStarted = false;
let timerInterval = null;

const gameArea = document.getElementById("gameArea");
const scoreDisplay = document.getElementById("score");
const timerDisplay = document.getElementById("timer");
const restartBtn = document.getElementById("restartBtn");
const leaderboardList = document.getElementById("leaderboardList");

/* -----------------------------------------------------
   SMOOTH AUTO-SCROLL
------------------------------------------------------ */
function smoothScroll() {
    window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
}

/* -----------------------------------------------------
   RANDOM COLOR
------------------------------------------------------ */
function randomColor() {
    const r = Math.floor(Math.random()*200);
    const g = Math.floor(Math.random()*200);
    const b = Math.floor(Math.random()*200);
    return `rgb(${r},${g},${b})`;
}

/* -----------------------------------------------------
   CREATE BUTTON
------------------------------------------------------ */
function createButton(forceType = null) {
    const btn = document.createElement("button");
    btn.className = "btn";
    btn.style.background = randomColor();

    let type;
    if (forceType) {
        type = forceType;
    } else {
        let roll = Math.random();
        if (roll < 0.20) type = "bomb";
        else if (roll < 0.30) type = "bonus";
        else type = "normal";
    }

    if (type === "bomb") {
        btn.textContent = "ðŸ’£ -2";
        btn.classList.add("bomb");
    } 
    else if (type === "bonus") {
        btn.textContent = "+3 â­";
        btn.classList.add("bonus");
    } 
    else {
        btn.textContent = "Click!";
    }

    btn.addEventListener("click", () => handleClick(btn, type));
    gameArea.appendChild(btn);

    smoothScroll();
}

/* -----------------------------------------------------
   HANDLE BUTTON CLICK
------------------------------------------------------ */
function handleClick(button, type) {

    if (!timerStarted) startTimer();
    button.classList.add("disabled");

    if (type === "bomb") score -= 2;
    else if (type === "bonus") score += 3;
    else score++;

    scoreDisplay.textContent = "Score: " + score;

    // ALWAYS add a new â€œsafeâ€ button so the game continues
    createButton();

    // Refresh color
    button.style.background = randomColor();
}

/* -----------------------------------------------------
   TIMER
------------------------------------------------------ */
function startTimer() {
    timerStarted = true;
    timerInterval = setInterval(() => {
        timeLeft--;

        if (timeLeft <= 3) {
            timerDisplay.style.color = timeLeft % 2 === 0 ? "red" : "black";
        }

        timerDisplay.textContent = "Timer: " + timeLeft;

        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            setTimeout(endGame, 300);
        }
    }, 1000);
}

/* -----------------------------------------------------
   END GAME
------------------------------------------------------ */
async function endGame() {
    const name = prompt("Game over! Enter your name:");
    if (name) {
        await addDoc(collection(db, "leaderboard"), {
            name: name,
            score: score,
            timestamp: Date.now()
        });
    }

    loadLeaderboard();
}

/* -----------------------------------------------------
   LOAD LEADERBOARD
------------------------------------------------------ */
async function loadLeaderboard() {
    leaderboardList.innerHTML = "";

    const q = query(
        collection(db, "leaderboard"),
        orderBy("score", "desc")
    );

    const snap = await getDocs(q);

    snap.forEach(doc => {
        const li = document.createElement("li");
        li.textContent = `${doc.data().name}: ${doc.data().score}`;
        leaderboardList.appendChild(li);
    });
}

/* -----------------------------------------------------
   RESTART
------------------------------------------------------ */
restartBtn.addEventListener("click", () => {
    score = 0;
    timeLeft = 30;
    timerStarted = false;

    scoreDisplay.textContent = "Score: 0";
    timerDisplay.textContent = "Timer: 30";
    timerDisplay.style.color = "black";

    gameArea.innerHTML = "";
    createButton();
});

/* -----------------------------------------------------
   START WITH ONE BUTTON
------------------------------------------------------ */
createButton();
loadLeaderboard();

</script>
</body>
</html>
