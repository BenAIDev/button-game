<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Button Click Game</title>

<style>
  body {
    font-family: Arial;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 20px;
  }

  #info { 
    display: flex; 
    gap: 20px; 
    margin-bottom: 20px; 
    font-size: 20px; 
  }

  #timer.flash { animation: flash 0.5s infinite alternate; }
  @keyframes flash { from { color: red; } to { color: black; } }

  #container { 
    display: flex; 
    flex-wrap: wrap; 
    gap: 10px; 
    justify-content: center; 
    max-width: 95vw;
  }

  .btn {
    padding: 16px 24px;
    font-size: 20px;
    border: none;
    cursor: pointer;
    background: #ddd;
    border-radius: 6px;
  }

  .clicked { 
    opacity: 0.5; 
    pointer-events: none; 
  }

  /* Mobile */
  body.mobile .btn {
    padding: 20px;
    font-size: 22px;
  }
</style>
</head>
<body>

<div id="info">
  <div>Score: <span id="score">0</span></div>
  <div>Time: <span id="timer">30</span>s</div>
  <button id="restart">Restart</button>
  <button id="resetLeaderboard">Reset Leaderboard</button>
</div>

<div id="container">
  <button class="btn" id="startBtn">Click me!</button>
</div>

<div id="leaderboard">
  <h3>Leaderboard</h3>
  <ol id="scoresList"></ol>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
/* ------------------ MOBILE DETECTION ------------------ */
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
if (isMobile) document.body.classList.add("mobile");

/* ------------------ FIREBASE INIT ------------------ */
let db = null;
try {
  const firebaseConfig = {
    apiKey: "AIzaSyBPLrSA5oKxw-PqBzrBZJa4u-LKjTmFM3Y",
    authDomain: "button-game-75748.firebaseapp.com",
    projectId: "button-game-75748",
    storageBucket: "button-game-75748.firebasestorage.app",
    messagingSenderId: "1003146862930",
    appId: "1:1003146862930:web:4eef5885db68e4cd541a8b"
  };
  firebase.initializeApp(firebaseConfig);
  db = firebase.firestore();
} catch (e) {
  console.warn("Firebase offline");
}

/* ------------------ LEADERBOARD ------------------ */
async function loadScores() {
  if (!db) return;
  const snap = await db.collection("scores").orderBy("score", "desc").limit(10).get();
  const list = document.getElementById("scoresList");
  list.innerHTML = "";
  snap.forEach(doc => {
    const d = doc.data();
    list.innerHTML += `<li>${d.name}: ${d.score}</li>`;
  });
}

async function saveScore(name, score) {
  if (!db) return;
  await db.collection("scores").add({ name, score, timestamp: Date.now() });
  loadScores();
}

/* ------------------ GAME LOGIC ------------------ */
let timeLeft = 30;
let timer = null;
let timerStarted = false;
let score = 0;

const container = document.getElementById("container");
const scoreEl = document.getElementById("score");
const timerEl = document.getElementById("timer");
const startBtn = document.getElementById("startBtn");

/* Timer */
function startTimer() {
  if (timerStarted) return;
  timerStarted = true;

  timer = setInterval(() => {
    timeLeft--;
    timerEl.textContent = timeLeft;

    if (timeLeft <= 3) timerEl.classList.add("flash");
    if (timeLeft === 0) endGame();

  }, 1000);
}

function endGame() {
  clearInterval(timer);
  document.querySelectorAll(".btn").forEach(b => b.disabled = true);

  const name = prompt("Game Over! Your name:");
  saveScore(name || "Anonymous", score);
}

/* Random button color */
function randomColor() {
  return "#" + Math.floor(Math.random() * 16777215).toString(16);
}

/* Add new button */
function addButton(type = "normal") {
  const btn = document.createElement("button");
  btn.className = "btn";

  if (type === "bonus") {
    btn.textContent = "+3 BONUS!";
    btn.style.background = "#ffcc00";
    btn.dataset.bonus = "1";

  } else if (type === "trap") {
    const n = Math.floor(Math.random() * 3) + 1;
    btn.textContent = `ðŸ’£ -${n}`;
    btn.style.background = "#ff4444";
    btn.dataset.trap = n;

  } else {
    btn.textContent = "Click me!";
  }

  btn.style.backgroundColor = randomColor();
  container.appendChild(btn);

  // Smooth autoscroll improvement
  setTimeout(() => {
    btn.scrollIntoView({ behavior: "smooth", block: "end" });
  }, 50);
}

  if (isMobile) {
    btn.scrollIntoView({ behavior: "smooth", block: "nearest" });
  }
}

/* Click handler */
container.addEventListener("click", e => {
  if (!e.target.classList.contains("btn")) return;

  startTimer();

  const btn = e.target;
  if (btn.classList.contains("clicked")) return;

  btn.classList.add("clicked");
  btn.style.backgroundColor = randomColor();

  // Score update
  if (btn.dataset.bonus) score += 3;
  else if (btn.dataset.trap) score -= parseInt(btn.dataset.trap);
  else score++;

  scoreEl.textContent = score;

// Generate next button:
const r = Math.random();

// 20% â†’ TRAP â†’ must spawn TWO buttons
if (r < 0.20) {
    addButton("trap"); // bomb always
    addButton(Math.random() < 0.20 ? "bonus" : "normal"); // always add playable button
}

// 15% â†’ BONUS
else if (r < 0.35) {
    addButton("bonus");
}

// 65% â†’ NORMAL
else {
    addButton("normal");
}
});

/* Restart */
document.getElementById("restart").onclick = () => location.reload();

/* Reset leaderboard */
document.getElementById("resetLeaderboard").onclick = async () => {
  if (!db) return alert("Leaderboard offline");
  if (!confirm("Delete ALL scores?")) return;
  const snap = await db.collection("scores").get();
  const batch = db.batch();
  snap.forEach(doc => batch.delete(doc.ref));
  await batch.commit();
  loadScores();
};

/* Initial leaderboard load */
loadScores();
</script>

</body>
</html>
