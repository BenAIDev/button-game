<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Button Click Game â€” Online Leaderboard</title>
<style>
  body { font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; margin: 20px; }
  #info { display: flex; gap: 20px; margin-bottom: 20px; font-size: 20px; position: relative; z-index: 20; }
  #timer { font-weight: bold; } .flash { animation: flash 0.5s infinite alternate; }
  @keyframes flash { from { color: red; } to { color: black; } }
  #container { display: flex; flex-wrap: wrap; gap: 10px; max-width: 600px; position: relative; z-index: 10; }
  .btn { padding: 12px 20px; cursor: pointer; border: none; background: #ddd; border-radius: 6px; font-size: 16px; }
  .clicked { pointer-events: none; opacity: 0.5; }
  #leaderboard { margin-top: 20px; text-align: center; width: 320px; }
  #scoresList { text-align: left; padding-left: 18px; }
  #resetLeaderboard { margin-left: 8px; }
</style>
</head>
<body>

<div id="info">
  <div>Score: <span id="score">0</span></div>
  <div>Time: <span id="timer">30</span>s</div>
  <button id="restart">Restart</button>
  <button id="resetLeaderboard">Reset Leaderboard</button>
</div>

<div id="container">
  <button class="btn" id="startBtn">Click me!</button>
</div>

<div id="leaderboard">
  <h3>Leaderboard (global)</h3>
  <ol id="scoresList"></ol>
</div>

<!-- Firebase (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
/* ======= FIREBASE CONFIG: REPLACE THE OBJECT BELOW WITH YOUR FIREBASE CONFIG =======
  You will get this from Firebase -> Project settings -> Your apps -> SDK setup
  Example:
  const firebaseConfig = {
    apiKey: "....",
    authDomain: "....firebaseapp.com",
    projectId: "your-project-id",
    storageBucket: "...",
    messagingSenderId: "...",
    appId: "..."
  };
================================================================================== */
const firebaseConfig = {
  apiKey: "AIzaSyBPLrSA5oKxw-PqBzrBZJa4u-LKjTmFM3Y",
  authDomain: "button-game-75748.firebaseapp.com",
  projectId: "button-game-75748",
  storageBucket: "button-game-75748.firebasestorage.app",
  messagingSenderId: "1003146862930",
  appId: "1:1003146862930:web:4eef5885db68e4cd541a8b",
  measurementId: "G-L6YS4FTY15"
};;

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ------------------- Game variables ------------------- */
let timeLeft = 30;
let timerStarted = false;
let timerInterval = null;
let score = 0;
let buttonCount = 1;

const scoreEl = document.getElementById("score");
const timerEl = document.getElementById("timer");
const container = document.getElementById("container");
const restartBtn = document.getElementById("restart");
const resetLeaderboardBtn = document.getElementById("resetLeaderboard");
const scoresList = document.getElementById("scoresList");

/* ---------- Leaderboard functions (Firestore) ---------- */
async function loadScoresOnline() {
  try {
    const snapshot = await db.collection("scores")
      .orderBy("score", "desc")
      .limit(10)
      .get();

    scoresList.innerHTML = "";
    snapshot.forEach(doc => {
      const d = doc.data();
      const li = document.createElement("li");
      const when = d.timestamp ? new Date(d.timestamp).toLocaleString() : '';
      li.textContent = `${d.name}: ${d.score} ${when ? ' â€” ' + when : ''}`;
      scoresList.appendChild(li);
    });
  } catch (err) {
    console.error("Failed to load scores:", err);
  }
}

async function saveScoreOnline(name, newScore) {
  try {
    await db.collection("scores").add({
      name: name || "Anonymous",
      score: newScore,
      timestamp: Date.now()
    });
    // reload leaderboard
    loadScoresOnline();
  } catch (err) {
    console.error("Failed to save score:", err);
  }
}

async function resetLeaderboardOnline() {
  if (!confirm("Delete ALL online scores? This cannot be undone from the client.")) return;
  // WARNING: this deletes documents one by one (client-side). Works for small datasets.
  const snapshot = await db.collection("scores").get();
  const batch = db.batch();
  snapshot.forEach(doc => batch.delete(doc.ref));
  await batch.commit();
  loadScoresOnline();
}

/* ------------------ Game & UI functions ------------------ */
function randomColor() {
  return "#" + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0');
}

function startTimerOnce() {
  if (timerStarted) return;
  timerStarted = true;
  timerInterval = setInterval(() => {
    timeLeft--;
    timerEl.textContent = timeLeft;
    if (timeLeft <= 3) timerEl.classList.add("flash");
    if (timeLeft <= 0) endGame();
  }, 1000);
}

function endGame() {
  clearInterval(timerInterval);
  timerEl.classList.remove("flash");
  // ask for name then save online
  const name = prompt("Game over! Enter your name for the global leaderboard:");
  saveScoreOnline(name, score);
  // disable buttons
  document.querySelectorAll(".btn").forEach(b => b.disabled = true);
}

function addButton(isBonus = false, isTrap = false) {
  buttonCount++;
  const newBtn = document.createElement("button");
  newBtn.className = "btn";
  if (isBonus) {
    newBtn.textContent = "+3 BONUS!";
    newBtn.style.background = "#ffcc00";
    newBtn.dataset.bonus = "true";
  } else if (isTrap) {
    const minus = Math.floor(Math.random() * 3) + 1;
    newBtn.textContent = `ðŸ’£ -${minus}`;
    newBtn.style.background = "#ff4444";
    newBtn.dataset.trap = minus;
  } else {
    newBtn.textContent = "Click me!";
  }
  // New row every 10 items
  if ((buttonCount - 1) % 10 === 0) {
    const br = document.createElement("div");
    br.style.flexBasis = "100%";
    container.appendChild(br);
  }
  container.appendChild(newBtn);
}

/* main click handler */
container.addEventListener("click", event => {
  if (!event.target.classList.contains("btn")) return;
  startTimerOnce();
  const btn = event.target;
  if (btn.classList.contains("clicked")) return;
  btn.classList.add("clicked");
  btn.style.background = randomColor();

  // Score logic
  if (btn.dataset.bonus) {
    score += 3;
  } else if (btn.dataset.trap) {
    const penalty = parseInt(btn.dataset.trap);
    score -= penalty;
  } else {
    score++;
  }
  scoreEl.textContent = score;

  // Random spawn: 15% bonus, 20% trap (as you asked earlier)
  let bonus = false, trap = false;
  const r = Math.random();
  if (r < 0.15) bonus = true;
  else if (r < 0.35) trap = true;

  if (trap) {
    addButton(false, true); // trap button
    const extraBonus = Math.random() < 0.20;
    addButton(extraBonus, false);
  } else {
    addButton(bonus, false);
  }
});

/* restart */
restartBtn.addEventListener("click", () => location.reload());

/* reset leaderboard (online) */
resetLeaderboardBtn.addEventListener("click", () => {
  resetLeaderboardOnline();
});

/* initialize */
(function init() {
  // reset game variables and render initial button state
  timeLeft = 30; timerStarted = false; score = 0; buttonCount = 1;
  scoreEl.textContent = "0";
  timerEl.textContent = timeLeft;
  container.innerHTML = '<button class="btn" id="startBtn">Click me!</button>';
  loadScoresOnline();
})();
</script>
</body>
</html>
