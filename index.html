<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Smooth Button Game â€” Fixed</title>

<style>
  :root {
    --max-width: 900px;
    --gap: 14px;
  }

  html,body {
    height: 100%;
    margin: 0;
    padding: 0;
    background: #f5f7fa;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    font-family: system-ui, Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 18px;
    gap: 16px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  h1 {
    margin: 0;
    font-size: 22px;
    color: #222;
  }

  /* Info / controls */
  #controls {
    width: 100%;
    max-width: var(--max-width);
    display:flex;
    gap:12px;
    justify-content:flex-start;
    align-items:center;
    z-index: 20;                 /* make sure controls are on top */
    position: relative;
    pointer-events: auto;
  }

  #controls .control-btn {
    padding: 10px 14px;
    border-radius: 10px;
    font-size: 14px;
    border: none;
    cursor: pointer;
    background: white;
    box-shadow: 0 6px 18px rgba(20,30,50,0.06);
  }

  /* game area */
  #game-area {
    width: 100%;
    max-width: var(--max-width);
    display: flex;
    flex-wrap: wrap;
    gap: var(--gap);
    justify-content: center;
    padding-bottom: 28px;
    z-index: 1;
    position: relative;
  }

  /* button */
  .game-btn {
    min-width: 110px;
    padding: 14px 18px;
    border-radius: 12px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    background: linear-gradient(180deg,#ffffff,#efefef);
    box-shadow: 0 6px 18px rgba(12,20,40,0.06);
    transition: transform .12s ease, box-shadow .12s ease, background .28s ease;
    will-change: transform, background;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
  }

  .game-btn:active { transform: scale(.97); }

  .bomb { background:#111 !important; color: #fff !important; box-shadow: 0 8px 22px rgba(0,0,0,0.16); }
  .trap { background:#ff5b5b !important; color:#fff !important; box-shadow: 0 8px 22px rgba(255, 50, 50, 0.16); }
  .bonus { background: linear-gradient(180deg,#fff7d4,#ffd24d) !important; color:#111 !important; box-shadow: 0 8px 22px rgba(200,150,0,0.12); }

  /* enter animation so new buttons feel organic */
  @keyframes pop {
    from { transform: scale(.6); opacity: 0; }
    to   { transform: scale(1); opacity: 1; }
  }
  .game-btn { animation: pop .22s ease both; }

  /* mobile tuning */
  @media (max-width:600px) {
    .game-btn { min-width: calc(20% - var(--gap)); padding: 16px; font-size: 16px; border-radius: 10px; }
    #controls { flex-wrap: wrap; gap:8px; }
  }

  /* debug overlay (hidden normally) */
  #debugLog {
    position: fixed; right: 8px; bottom: 8px;
    background: rgba(0,0,0,0.6); color: white; padding:8px 12px; border-radius:8px;
    font-size:12px; z-index:9999; display:none;
  }
</style>
</head>
<body>

<h1>Smooth Button Game</h1>

<div id="controls">
  <button id="startBtn" class="control-btn">Start</button>
  <button id="restartBtn" class="control-btn">Restart</button>
  <button id="clearLeaderboardBtn" class="control-btn">Reset Leaderboard</button>
  <div style="margin-left:12px;color:#444;font-size:14px;">Score: <span id="score">0</span></div>
  <div style="margin-left:auto;color:#444;font-size:14px;">Time: <span id="timer">30</span>s</div>
</div>

<div id="game-area" aria-live="polite"></div>

<div id="debugLog" aria-hidden="true"></div>

<!-- Core game script -->
<script>
(function () {
  // Defensive DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

  function init() {
    // Elements
    const gameArea = document.getElementById('game-area');
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');
    const clearLeaderboardBtn = document.getElementById('clearLeaderboardBtn');
    const scoreEl = document.getElementById('score');
    const timerEl = document.getElementById('timer');
    const debugLog = document.getElementById('debugLog');

    // State
    let isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    if (isMobile) document.body.classList.add('mobile');
    let timer = null;
    let timeLeft = 30;
    let timerStarted = false;
    let score = 0;

    // Safe logger (shows small overlay when started)
    function logDebug(msg, visible = false) {
      console.log(msg);
      debugLog.textContent = msg;
      if (visible) debugLog.style.display = 'block';
      else { /* leave hidden by default */ }
    }

    // Random color â€” always fairly bright
    function randomColor() {
      const r = 60 + Math.floor(Math.random() * 160);
      const g = 60 + Math.floor(Math.random() * 160);
      const b = 60 + Math.floor(Math.random() * 160);
      return `rgb(${r},${g},${b})`;
    }

    // Scroll into view in a gentle way
    function smoothScrollTo(elem) {
      try {
        elem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      } catch (e) { window.scrollTo(0, document.body.scrollHeight); }
    }

    // Create a single button of type: 'normal' | 'bonus' | 'trap' | 'bomb'
    function createButton(type = 'normal') {
      const btn = document.createElement('button');
      btn.className = 'game-btn';
      btn.setAttribute('type','button');

      // Content + dataset
      if (type === 'bonus') {
        btn.textContent = 'â­ BONUS';
        btn.classList.add('bonus');
        btn.dataset.type = 'bonus';
      } else if (type === 'trap') {
        btn.textContent = 'âŒ TRAP';
        btn.classList.add('trap');
        btn.dataset.type = 'trap';
      } else if (type === 'bomb') {
        btn.textContent = 'ðŸ’£ BOMB';
        btn.classList.add('bomb');
        btn.dataset.type = 'bomb';
      } else {
        btn.textContent = 'Click';
        btn.dataset.type = 'normal';
      }

      // style base color
      btn.style.background = randomColor();

      // click handler
      btn.addEventListener('click', () => handleClick(btn));

      // append and return
      gameArea.appendChild(btn);

      // smooth scroll into view for mobile or if page tall
      if (isMobile) {
        setTimeout(() => smoothScrollTo(btn), 40);
      }

      return btn;
    }

    // Start timer
    function startTimerOnce() {
      if (timerStarted) return;
      timerStarted = true;
      timer = setInterval(() => {
        timeLeft--;
        timerEl.textContent = timeLeft;
        if (timeLeft <= 3) timerEl.classList.add('flash');
        if (timeLeft <= 0) endGame();
      }, 1000);
    }

    // End game
    function endGame() {
      clearInterval(timer);
      timerStarted = false;
      // disable existing buttons
      document.querySelectorAll('.game-btn').forEach(b => b.disabled = true);
      // simple prompt for name (you can replace with custom UI)
      setTimeout(() => {
        const name = prompt('Game over â€” enter your name for leaderboard (optional):') || 'Anonymous';
        // Save score via your backend here if needed
        logDebug('Game ended. Score saved for ' + name, true);
      }, 100);
    }

    // Handle click on any game button
    function handleClick(btn) {
      // make sure game is active
      startTimerOnce();

      // prevent double click
      if (btn.classList.contains('clicked')) return;
      btn.classList.add('clicked');

      // change color on click to feel organic
      btn.style.transition = 'background .3s ease';
      btn.style.background = randomColor();

      // Decide outcome probabilities:
      // bomb 10%, trap 10%, bonus 10%, normal 70%
      const v = Math.random();
      if (v < 0.10) {
        // bomb
        btn.textContent = 'ðŸ’£ BOMB';
        btn.classList.remove('trap','bonus');
        btn.classList.add('bomb');
        score = Math.max(0, score - 1);
        // when bomb appears, spawn an extra playable button (normal or bonus)
        createButton(Math.random() < 0.20 ? 'bonus' : 'normal');
      } else if (v < 0.20) {
        // trap
        btn.textContent = 'âŒ TRAP';
        btn.classList.remove('bomb','bonus');
        btn.classList.add('trap');
        score = Math.max(0, score - 1);
        // spawn an extra playable button
        createButton(Math.random() < 0.20 ? 'bonus' : 'normal');
      } else if (v < 0.30) {
        // bonus
        btn.textContent = 'â­ BONUS';
        btn.classList.remove('bomb','trap');
        btn.classList.add('bonus');
        score += 3;
        // reward with an extra button as well
        createButton('normal');
      } else {
        // normal
        btn.textContent = 'Click';
        score += 1;
      }

      // update score UI
      scoreEl.textContent = score;
    }

    // Attach control handlers
    startBtn.addEventListener('click', () => {
      startBtn.disabled = true;
      startBtn.style.opacity = 0.6;
      // create first set of buttons (1 initial)
      createButton('normal');
      logDebug('Game started', false);
    });

    restartBtn.addEventListener('click', () => {
      // reset state
      clearInterval(timer);
      timerStarted = false;
      timeLeft = 30;
      timerEl.textContent = timeLeft;
      score = 0;
      scoreEl.textContent = 0;
      // clear buttons
      gameArea.innerHTML = '';
      startBtn.disabled = false;
      startBtn.style.opacity = 1;
      logDebug('Game reset', false);
    });

    clearLeaderboardBtn.addEventListener('click', () => {
      if (!confirm('Clear leaderboard stored online?')) return;
      // Placeholder â€” call backend to clear if you have one
      logDebug('Leaderboard cleared (client placeholder)', true);
    });

    // defensive: click anywhere on page shows console hint if buttons not responding
    document.addEventListener('click', () => {
      // no-op: used for debugging if user says clicks do nothing
    });

    // initialize UI values
    timerEl.textContent = timeLeft;
    scoreEl.textContent = score;
    logDebug('Ready â€” DOM loaded', false);
  } // init end
})(); // IIFE end
</script>
</body>
</html>
