<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Button Click Game</title>

<style>
  body {
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 20px;
  }

  #info {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    font-size: 20px;
    position: relative;      /* FIX */
    z-index: 20;             /* FIX */
  }

  #timer {
    font-weight: bold;
  }

  .flash {
    animation: flash 0.5s infinite alternate;
  }

  @keyframes flash {
    from { color: red; }
    to { color: black; }
  }

  #container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    max-width: 600px;
    position: relative;      /* FIX */
    z-index: 10;             /* FIX */
  }

  .btn {
    padding: 12px 20px;
    cursor: pointer;
    border: none;
    background: #ddd;
    border-radius: 6px;
    font-size: 16px;
  }

  .clicked {
    pointer-events: none;
    opacity: 0.5;
  }

  #leaderboard {
    margin-top: 20px;
    text-align: center;
  }
</style>
</head>

<body>

<div id="info">
  <div>Score: <span id="score">0</span></div>
  <div>Time: <span id="timer">30</span>s</div>
  <button id="restart">Restart</button>
</div>

<div id="container">
  <button class="btn" id="startBtn">Click me!</button>
</div>

<div id="leaderboard">
  <h3>Leaderboard</h3>
  <ol id="scoresList"></ol>
</div>

<script>
let timeLeft = 30;
let timerStarted = false;
let timerInterval = null;
let score = 0;
let buttonCount = 1; // includes the first button

const scoreEl = document.getElementById("score");
const timerEl = document.getElementById("timer");
const container = document.getElementById("container");
const restartBtn = document.getElementById("restart");
const scoresList = document.getElementById("scoresList");

// Load leaderboard
function loadScores() {
  const saved = JSON.parse(localStorage.getItem("leaderboard") || "[]");
  scoresList.innerHTML = "";
  
  saved.slice(0, 10).forEach(entry => {
    const li = document.createElement("li");
    li.textContent = `${entry.name}: ${entry.score}`;
    scoresList.appendChild(li);
  });
}
loadScores();

function saveScore(newScore) {
  let name = prompt("Enter your name:");

  if (!name) name = "Anonymous";

  let scores = JSON.parse(localStorage.getItem("leaderboard") || "[]");

  // Save objects instead of just numbers
  scores.push({ name, score: newScore });

  // Sort from highest to lowest
  scores.sort((a, b) => b.score - a.score);

  // Keep top 10
  scores = scores.slice(0, 10);

  localStorage.setItem("leaderboard", JSON.stringify(scores));
  loadScores();
}

// Generate random color
function randomColor() {
  return "#" + Math.floor(Math.random() * 16777215).toString(16);
}

// Start timer on first click
function startTimerOnce() {
  if (timerStarted) return;
  timerStarted = true;

  timerInterval = setInterval(() => {
    timeLeft--;
    timerEl.textContent = timeLeft;

    if (timeLeft <= 3) {
      timerEl.classList.add("flash");
    }

    if (timeLeft <= 0) {
      endGame();
    }
  }, 1000);
}

function endGame() {
  clearInterval(timerInterval);
  timerEl.classList.remove("flash");

  // Save high score
  saveScore(score);

  // Disable all buttons
  document.querySelectorAll(".btn").forEach(b => b.disabled = true);
}

function addButton(isBonus = false, isTrap = false) {
  buttonCount++;

  const newBtn = document.createElement("button");
  newBtn.className = "btn";

  if (isBonus) {
    newBtn.textContent = "+3 BONUS!";
    newBtn.style.background = "#ffcc00";
    newBtn.dataset.bonus = "true";

  } else if (isTrap) {
    const minus = Math.floor(Math.random() * 3) + 1;   // -1 to -3
    newBtn.textContent = `ðŸ’£ -${minus}`;
    newBtn.style.background = "#ff4444";
    newBtn.dataset.trap = minus;

  } else {
    newBtn.textContent = "Click me!";
  }

  // New row every 10 items
  if ((buttonCount - 1) % 10 === 0) {
    const br = document.createElement("div");
    br.style.flexBasis = "100%";
    container.appendChild(br);
  }

  container.appendChild(newBtn);
}

// Handle all button clicks
container.addEventListener("click", event => {
  if (!event.target.classList.contains("btn")) return;

  startTimerOnce();   // timer starts at first click

  const btn = event.target;

  if (btn.classList.contains("clicked")) return; // prevent double click

  btn.classList.add("clicked");
  btn.style.background = randomColor();

// Score logic
if (btn.dataset.bonus) {
  score += 3;

} else if (btn.dataset.trap) {
  const penalty = parseInt(btn.dataset.trap);
  score -= penalty;

} else {
  score++;
}

  scoreEl.textContent = score;

// Random spawn: 15% bonus, 20% trap
let bonus = false;
let trap = false;

const r = Math.random();

if (r < 0.15) {
  bonus = true;
} else if (r < 0.35) {
  trap = true;
}

// If trap â†’ spawn a trap AND an extra button (normal or bonus)
if (trap) {
  addButton(false, true);  // trap button

  // 20% chance the extra one is bonus
  const extraBonus = Math.random() < 0.20;
  addButton(extraBonus, false);  

} else {
  // normal spawn logic
  addButton(bonus, false);
}

});

restartBtn.addEventListener("click", () => {
  location.reload();
});
</script>
</body>
</html>
